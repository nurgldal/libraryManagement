<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management</title>
    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEJv+M8B6DAXa98aBL5dJdyYoKbCB5r+F5/JxzpUduRrntT0q9p1yXz5Fdpnt" crossorigin="anonymous">
    <script>
        // Fetch members from the backend
        async function fetchMembers() {
            const response = await fetch('/api/members');
            const members = await response.json();
            const membersList = document.getElementById('members-list');
            membersList.innerHTML = '';
            members.forEach(member => {
                membersList.innerHTML += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${member.name} - ${member.telephone} 
                        <button class="btn btn-danger btn-sm" onclick="deleteMember(${member.id})">Delete</button>
                        <button class="btn btn-warning btn-sm" onclick="showEditMemberForm(${member.id})" data-bs-toggle="modal" data-bs-target="#editMemberModal">Edit</button>
                    </li>
                `;
            });
        }

        // Create a new member
        async function createMember() {
            const name = document.getElementById('name').value;
            const address = document.getElementById('address').value;
            const telephone = document.getElementById('telephone').value;

            const response = await fetch('/api/members', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, address, telephone })
            });

            if (response.ok) {
                fetchMembers(); // Reload the list of members
                document.getElementById('name').value = '';  // Clear form after submission
                document.getElementById('address').value = '';
                document.getElementById('telephone').value = '';
            }
        }

        // Delete an existing member
        async function deleteMember(id) {
            const response = await fetch(`/api/members/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                fetchMembers(); // Reload the list of members
            }
        }

        // Show edit form with current member details
        async function showEditMemberForm(id) {
            const response = await fetch(`/api/members/${id}`);
            const member = await response.json();

            document.getElementById('edit-name').value = member.name;
            document.getElementById('edit-address').value = member.address;
            document.getElementById('edit-telephone').value = member.telephone;
            document.getElementById('edit-id').value = member.id;
        }

        // Edit an existing member
        async function editMember() {
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value;
            const address = document.getElementById('edit-address').value;
            const telephone = document.getElementById('edit-telephone').value;

            const response = await fetch(`/api/members/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, address, telephone })
            });

            if (response.ok) {
                fetchMembers(); // Reload the list of members
                var myModal = new bootstrap.Modal(document.getElementById('editMemberModal'));
                myModal.hide(); // Hide the modal
            }
        }
    </script>
</head>
<body onload="fetchMembers()" class="container mt-4">
    <h1 class="mb-4">Library Management</h1>

    <!-- Add Member Form -->
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addMemberModal">Add Member</button>

    <!-- List of Members -->
    <h3>Member List</h3>
    <ul id="members-list" class="list-group"></ul>

    <!-- Add Member Modal -->
    <div class="modal fade" id="addMemberModal" tabindex="-1" aria-labelledby="addMemberModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMemberModalLabel">Add Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="name">Name:</label><br>
                    <input type="text" id="name" class="form-control mb-3" required><br>
                    <label for="address">Address:</label><br>
                    <input type="text" id="address" class="form-control mb-3" required><br>
                    <label for="telephone">Telephone:</label><br>
                    <input type="text" id="telephone" class="form-control mb-3" required><br>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="createMember()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Member Modal -->
    <div class="modal fade" id="editMemberModal" tabindex="-1" aria-labelledby="editMemberModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editMemberModalLabel">Edit Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="edit-name">Name:</label><br>
                    <input type="text" id="edit-name" class="form-control mb-3" required><br>
                    <label for="edit-address">Address:</label><br>
                    <input type="text" id="edit-address" class="form-control mb-3" required><br>
                    <label for="edit-telephone">Telephone:</label><br>
                    <input type="text" id="edit-telephone" class="form-control mb-3" required><br>
                    <input type="hidden" id="edit-id">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editMember()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4z8Vb8Mj3fGg92pTqk0c6cXzMwGg2A5YwZaUar3vA34vfjfs2jWhw" crossorigin="anonymous"></script>
</body>
</html>
